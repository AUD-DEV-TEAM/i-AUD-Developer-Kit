SELECT RN
     , PROD_NAME
     , CATEGORY
     , SALES_QTY
     , SALES_AMOUNT
  FROM (
		SELECT ROW_NUMBER() OVER (ORDER BY SUM(S.NET_AMOUNT) DESC) AS RN
			 , P.PROD_NAME
			 , CM.CODE_NAME		 AS CATEGORY
			 , SUM(S.QTY)        AS SALES_QTY
			 , SUM(S.NET_AMOUNT) AS SALES_AMOUNT
		  FROM SM_SALES_PERFORMANCE S
		  LEFT JOIN SM_PRODUCT P
		    ON S.PROD_ID = P.PROD_ID
		  LEFT JOIN SM_COMMON_CODE CM
			ON CM.GROUP_CD = 'PROD_CATEGORY'
		   AND P.CATEGORY = CM.CODE
		 WHERE TO_CHAR(S.SALES_DATE,'YYYY') = :VS_YEAR
		 GROUP BY P.PROD_NAME, CM.CODE_NAME
		) T
  WHERE RN <= :VN_RANK_PRD
  ORDER BY RN