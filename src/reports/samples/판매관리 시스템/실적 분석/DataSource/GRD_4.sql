WITH REMARKS_GRP AS (
	SELECT CASE 
		WHEN REGEXP_REPLACE(REMARKS, '^.*\s', '') IN ('납품', '구매', '발주')
			THEN REGEXP_REPLACE(REMARKS, '^.*\s', '')
		ELSE '기타'
		END AS REMARKS
	  , SALES_DATE
	  FROM SM_SALES_PERFORMANCE
)
SELECT REMARKS
	 , SUM(CASE WHEN EXTRACT(YEAR FROM SALES_DATE) =  :VS_YEAR      THEN 1 ELSE 0 END) AS THIS_YEAR_CNT
	 , SUM(CASE WHEN EXTRACT(YEAR FROM SALES_DATE) = (:VS_YEAR - 1) THEN 1 ELSE 0 END) AS LAST_YEAR_CNT
	 , SUM(CASE WHEN EXTRACT(YEAR FROM SALES_DATE) =  :VS_YEAR      THEN 1 ELSE 0 END) - SUM(CASE WHEN EXTRACT(YEAR FROM SALES_DATE) = (:VS_YEAR - 1) THEN 1 ELSE 0 END) AS DIFF
  FROM REMARKS_GRP
 GROUP BY REMARKS