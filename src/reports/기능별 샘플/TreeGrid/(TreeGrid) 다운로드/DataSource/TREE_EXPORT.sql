WITH RECURSIVE FOLDER_MENU AS (
    SELECT FOLDER_CODE 				AS CODE
		 , FOLDER_NAME 				AS NAME
		 , PARENT_FOLDER_CODE 		AS PCODE
		 , 'F0.png'					AS IMG
		 , 0						AS SEQ1
		 , FOLDER_SEQ				AS SEQ2
		 , 1 						AS LEVEL
		 , ARRAY[FOLDER_CODE::TEXT] AS PATH
    FROM MTX_FOLDER
    WHERE PARENT_FOLDER_CODE = 'DEFAULT'

    UNION ALL

    SELECT f.FOLDER_CODE
		 , f.FOLDER_NAME
		 , f.PARENT_FOLDER_CODE
		 , 'F0.png'
		 , 0
		 , f.FOLDER_SEQ
		 , fm.LEVEL + 1
		 , fm.PATH || f.FOLDER_CODE::TEXT
    FROM MTX_FOLDER f
    	 INNER JOIN FOLDER_MENU fm
		 	ON f.PARENT_FOLDER_CODE = fm.CODE
),
REPORT_MENU AS (
    SELECT CODE
		 , NAME
		 , NULL 	AS REPORT_CODE
		 , NULL 	AS REPORT_NAME
		 , PCODE
		 , IMG
		 , SEQ1
		 , SEQ2
		 , LEVEL
		 , PATH
    FROM FOLDER_MENU

    UNION ALL

    SELECT r.REPORT_CODE
		 , r.REPORT_NAME
		 , r.REPORT_CODE
		 , r.REPORT_NAME
		 , fm.CODE
		 , r.MODULE_CODE || '.png'
		 , 1
		 , r.REPORT_SEQ
		 , fm.LEVEL + 1
		 , fm.PATH || r.REPORT_CODE::TEXT
      FROM MTX_REPORT r
   		   INNER JOIN FOLDER_MENU fm 
			  ON r.FOLDER_CODE = fm.CODE
)
SELECT CODE
	 , NAME
	 , CASE WHEN PCODE = 'DEFAULT' THEN NULL
	 	    ELSE PCODE
	   END  AS PCODE
	 , IMG
	 , SEQ1
	 , SEQ2
	 , LEVEL
	 , ARRAY_TO_STRING(PATH, ' > ') AS PATH
  FROM REPORT_MENU
 WHERE NOT EXISTS (
					SELECT 1
					  FROM REPORT_MENU t
					 WHERE 1=1
					   AND t.CODE LIKE 'MY%'
					    OR t.CODE IN (
									'DEFAULT',
									'MOBILE',
									'SYSTEM_TEMPLATE',
									'MATRIX_TEMPLATE_MENU',
									'REPORT_TEMPLATE'
								)
					   AND REPORT_MENU.PATH @> t.PATH
				  )
ORDER BY SEQ1, SEQ2