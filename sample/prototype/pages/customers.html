<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜ì—…ê´€ë¦¬ ì‹œìŠ¤í…œ - ê³ ê° ê´€ë¦¬</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <div class="layout">
        <!-- ì‚¬ì´ë“œë°” -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>ì˜ì—…ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
            </div>
            <nav class="sidebar-nav">
                <a href="../index.html" class="nav-item">
                    <span class="nav-icon">ğŸ“Š</span>
                    <span>ëŒ€ì‹œë³´ë“œ</span>
                </a>
                <a href="employees.html" class="nav-item">
                    <span class="nav-icon">ğŸ‘¥</span>
                    <span>ì§ì› ê´€ë¦¬</span>
                </a>
                <a href="customers.html" class="nav-item active">
                    <span class="nav-icon">ğŸ¢</span>
                    <span>ê³ ê° ê´€ë¦¬</span>
                </a>
                <a href="products.html" class="nav-item">
                    <span class="nav-icon">ğŸ“¦</span>
                    <span>ì œí’ˆ ê´€ë¦¬</span>
                </a>
                <a href="inventory.html" class="nav-item">
                    <span class="nav-icon">ğŸ­</span>
                    <span>ì¬ê³  ê´€ë¦¬</span>
                </a>
                <a href="sales-plan.html" class="nav-item">
                    <span class="nav-icon">ğŸ“‹</span>
                    <span>ì˜ì—… ê³„íš</span>
                </a>
                <a href="sales-performance.html" class="nav-item">
                    <span class="nav-icon">ğŸ“ˆ</span>
                    <span>ì˜ì—… ì‹¤ì </span>
                </a>
            </nav>
        </aside>

        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <main class="main-content">
            <header class="header">
                <h2>ê³ ê° ê´€ë¦¬</h2>
            </header>

            <div class="content">
                <div class="master-detail-layout">
                    <!-- ì¢Œì¸¡: ê³ ê° ëª©ë¡ -->
                    <div class="master-panel">
                        <div class="card">
                            <div class="card-header">
                                <h3>ê³ ê° ëª©ë¡ (<span id="totalCount">0</span>ê°œì‚¬)</h3>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <input type="text" id="searchKeyword" class="form-control" style="width: 220px;" placeholder="ê³ ê°ëª…, ì‚¬ì—…ìë²ˆí˜¸ë¡œ ê²€ìƒ‰">
                                    <button class="btn btn-primary btn-sm" onclick="searchCustomers()">ê²€ìƒ‰</button>
                                    <button class="btn btn-danger btn-sm" onclick="deleteSelectedCustomers()">ì‚­ì œ</button>
                                </div>
                            </div>
                            <div class="card-body" style="padding: 0; overflow: auto;">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th style="width: 40px;"><input type="checkbox" id="checkAll" onclick="toggleAllCheckboxes()"></th>
                                            <th>ê³ ê°ID</th>
                                            <th>ê³ ê°ëª…</th>
                                            <th>ìœ í˜•</th>
                                            <th>ë“±ê¸‰</th>
                                            <th>ì‚¬ì—…ìë²ˆí˜¸</th>
                                            <th>ì—°ë½ì²˜</th>
                                        </tr>
                                    </thead>
                                    <tbody id="customerTableBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- ìš°ì¸¡: ê³ ê° ë“±ë¡/ìˆ˜ì • í¼ -->
                    <div class="detail-panel">
                        <div class="card">
                            <div class="card-header">
                                <h3 id="formTitle">ê³ ê° ë“±ë¡</h3>
                            </div>
                            <div class="card-body">
                                <form id="customerForm">
                                    <input type="hidden" id="editCustId">
                                    <div class="form-row" style="grid-template-columns: 1fr 1fr;">
                                        <div class="form-group">
                                            <label class="form-label">ê³ ê°ëª… *</label>
                                            <input type="text" id="custNm" class="form-control" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">ê³ ê°ìœ í˜• *</label>
                                            <select id="custType" class="form-control" required>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-row" style="grid-template-columns: 1fr 1fr;">
                                        <div class="form-group">
                                            <label class="form-label">ê³ ê°ë“±ê¸‰ *</label>
                                            <select id="custGrade" class="form-control" required>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">ì™¸ìƒ ê°€ëŠ¥ í•œë„ ê¸ˆì•¡</label>
                                            <input type="number" id="creditLimit" class="form-control" value="0" min="0">
                                        </div>
                                    </div>
                                    <div class="form-row" style="grid-template-columns: 1fr 1fr;">
                                        <div class="form-group">
                                            <label class="form-label">ì‚¬ì—…ìë²ˆí˜¸</label>
                                            <input type="text" id="bizNo" class="form-control" placeholder="000-00-00000">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">ì—°ë½ì²˜</label>
                                            <input type="tel" id="contactPhone" class="form-control" placeholder="010-0000-0000">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">ì´ë©”ì¼</label>
                                        <input type="email" id="contactEmail" class="form-control">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">ì‚¬ì—…ì¥ ì£¼ì†Œ</label>
                                        <input type="text" id="address" class="form-control">
                                    </div>
                                </form>
                            </div>
                            <div class="panel-footer">
                                <button class="btn btn-outline" onclick="resetForm()">ì´ˆê¸°í™”</button>
                                <button class="btn btn-primary" onclick="saveCustomer()">ì €ì¥</button>
                                <button class="btn btn-primary" onclick="addNewCustomer()">ì¶”ê°€</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="../js/mock-data.js"></script>
    <script src="../js/common.js"></script>
    <script>
        let filteredData = [];
        let selectedCustId = null;

        document.addEventListener('DOMContentLoaded', function() {
            initPage();
        });

        function initPage() {
            // í¼ ì…€ë ‰íŠ¸ë°•ìŠ¤ ì´ˆê¸°í™”
            populateSelectFromCode('custType', 'CUST_TYPE', false);
            populateSelectFromCode('custGrade', 'CUST_GRADE', false);

            // ë°ì´í„° ë¡œë“œ
            loadCustomers();
        }

        function loadCustomers() {
            filteredData = [...CUSTOMERS];
            renderTable();
        }

        function searchCustomers() {
            const keyword = document.getElementById('searchKeyword').value.toLowerCase();

            if (!keyword) {
                loadCustomers();
                return;
            }

            filteredData = CUSTOMERS.filter(function(cust) {
                var searchFields = [cust.CUST_NM, cust.BIZ_NO || ''].join(' ').toLowerCase();
                return searchFields.indexOf(keyword) !== -1;
            });

            renderTable();
        }

        function renderTable() {
            var tbody = document.getElementById('customerTableBody');
            var totalCount = document.getElementById('totalCount');

            totalCount.textContent = filteredData.length;

            tbody.innerHTML = '';
            filteredData.forEach(function(cust) {
                var tr = document.createElement('tr');
                tr.style.cursor = 'pointer';
                tr.className = cust.CUST_ID === selectedCustId ? 'selected' : '';
                tr.onclick = function() { selectCustomer(cust.CUST_ID); };
                tr.innerHTML =
                    '<td><input type="checkbox" class="row-checkbox" value="' + cust.CUST_ID + '" onclick="event.stopPropagation()"></td>' +
                    '<td>' + cust.CUST_ID + '</td>' +
                    '<td>' + cust.CUST_NM + '</td>' +
                    '<td>' + getCodeName('CUST_TYPE', cust.CUST_TYPE) + '</td>' +
                    '<td>' + cust.CUST_GRADE + '</td>' +
                    '<td>' + (cust.BIZ_NO || '') + '</td>' +
                    '<td>' + (cust.CONTACT_PHONE || '') + '</td>';
                tbody.appendChild(tr);
            });
        }

        function selectCustomer(custId) {
            selectedCustId = custId;
            var cust = CUSTOMERS.find(function(c) { return c.CUST_ID === custId; });
            if (!cust) return;

            document.getElementById('formTitle').textContent = 'ê³ ê° ë“±ë¡';
            document.getElementById('editCustId').value = cust.CUST_ID;
            document.getElementById('custNm').value = cust.CUST_NM;
            document.getElementById('custType').value = cust.CUST_TYPE;
            document.getElementById('custGrade').value = cust.CUST_GRADE;
            document.getElementById('creditLimit').value = cust.CREDIT_LIMIT || 0;
            document.getElementById('bizNo').value = cust.BIZ_NO || '';
            document.getElementById('contactPhone').value = cust.CONTACT_PHONE || '';
            document.getElementById('contactEmail').value = cust.CONTACT_EMAIL || '';
            document.getElementById('address').value = cust.ADDRESS || '';

            renderTable();
        }

        function saveCustomer() {
            var custId = document.getElementById('editCustId').value;
            var formData = {
                CUST_NM: document.getElementById('custNm').value,
                CUST_TYPE: document.getElementById('custType').value,
                CUST_GRADE: document.getElementById('custGrade').value,
                CREDIT_LIMIT: parseInt(document.getElementById('creditLimit').value) || 0,
                BIZ_NO: document.getElementById('bizNo').value,
                CONTACT_PHONE: document.getElementById('contactPhone').value,
                CONTACT_EMAIL: document.getElementById('contactEmail').value,
                ADDRESS: document.getElementById('address').value
            };

            if (!formData.CUST_NM || !formData.CUST_TYPE || !formData.CUST_GRADE) {
                showAlert('í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (custId) {
                var index = CUSTOMERS.findIndex(function(c) { return c.CUST_ID === custId; });
                if (index !== -1) {
                    for (var key in formData) {
                        CUSTOMERS[index][key] = formData[key];
                    }
                }
                showAlert('ê³ ê° ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } else {
                addNewCustomer();
                return;
            }

            loadCustomers();
        }

        function addNewCustomer() {
            var formData = {
                CUST_NM: document.getElementById('custNm').value,
                CUST_TYPE: document.getElementById('custType').value,
                CUST_GRADE: document.getElementById('custGrade').value,
                CREDIT_LIMIT: parseInt(document.getElementById('creditLimit').value) || 0,
                BIZ_NO: document.getElementById('bizNo').value,
                CONTACT_PHONE: document.getElementById('contactPhone').value,
                CONTACT_EMAIL: document.getElementById('contactEmail').value,
                ADDRESS: document.getElementById('address').value
            };

            if (!formData.CUST_NM || !formData.CUST_TYPE || !formData.CUST_GRADE) {
                showAlert('í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            var newCustId = 'CUST' + String(CUSTOMERS.length + 1).padStart(3, '0');
            formData.CUST_ID = newCustId;
            formData.CREATED_AT = new Date().toISOString();
            formData.CREATED_BY = 'admin';
            CUSTOMERS.push(formData);

            showAlert('ê³ ê°ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
            resetForm();
            loadCustomers();
        }

        function toggleAllCheckboxes() {
            var checkAll = document.getElementById('checkAll');
            var checkboxes = document.querySelectorAll('.row-checkbox');
            checkboxes.forEach(function(cb) { cb.checked = checkAll.checked; });
        }

        function deleteSelectedCustomers() {
            var checkboxes = document.querySelectorAll('.row-checkbox:checked');
            if (checkboxes.length === 0) {
                showAlert('ì‚­ì œí•  í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            if (!showConfirm('ì„ íƒí•œ ' + checkboxes.length + 'ê°œ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            var idsToDelete = Array.from(checkboxes).map(function(cb) { return cb.value; });
            idsToDelete.forEach(function(custId) {
                var index = CUSTOMERS.findIndex(function(c) { return c.CUST_ID === custId; });
                if (index !== -1) {
                    CUSTOMERS.splice(index, 1);
                }
            });

            document.getElementById('checkAll').checked = false;
            selectedCustId = null;
            showAlert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            resetForm();
            loadCustomers();
        }

        function resetForm() {
            document.getElementById('formTitle').textContent = 'ê³ ê° ë“±ë¡';
            document.getElementById('customerForm').reset();
            document.getElementById('editCustId').value = '';
            document.getElementById('creditLimit').value = '0';
            selectedCustId = null;
            renderTable();
        }
    </script>
</body>
</html>
