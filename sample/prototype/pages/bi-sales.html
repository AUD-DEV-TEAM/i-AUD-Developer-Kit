<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÏòÅÏóÖÍ¥ÄÎ¶¨ ÏãúÏä§ÌÖú - Îß§Ï∂ú Î∂ÑÏÑù</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <div class="layout">
        <!-- ÏÇ¨Ïù¥ÎìúÎ∞î -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>ÏòÅÏóÖÍ¥ÄÎ¶¨ ÏãúÏä§ÌÖú</h1>
            </div>
            <nav class="sidebar-nav">
                <a href="../index.html" class="nav-item">
                    <span class="nav-icon">üìä</span>
                    <span>ÎåÄÏãúÎ≥¥Îìú</span>
                </a>
                <a href="employees.html" class="nav-item">
                    <span class="nav-icon">üë•</span>
                    <span>ÏßÅÏõê Í¥ÄÎ¶¨</span>
                </a>
                <a href="employees-type1.html" class="nav-item">
                    <span class="nav-icon">üë•</span>
                    <span>ÏßÅÏõê Í¥ÄÎ¶¨ (Ïú†Ìòï1)</span>
                </a>
                <a href="employees-type2.html" class="nav-item">
                    <span class="nav-icon">üë•</span>
                    <span>ÏßÅÏõê Í¥ÄÎ¶¨ (Ïú†Ìòï2)</span>
                </a>
                <a href="customers.html" class="nav-item">
                    <span class="nav-icon">üè¢</span>
                    <span>Í≥†Í∞ù Í¥ÄÎ¶¨</span>
                </a>
                <a href="products.html" class="nav-item">
                    <span class="nav-icon">üì¶</span>
                    <span>Ï†úÌíà Í¥ÄÎ¶¨</span>
                </a>
                <a href="common-code.html" class="nav-item">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span>Í≥µÌÜµÏΩîÎìú Í¥ÄÎ¶¨</span>
                </a>
                <a href="bi-sales.html" class="nav-item active">
                    <span class="nav-icon">üìà</span>
                    <span>Îß§Ï∂ú Î∂ÑÏÑù</span>
                </a>
                <a href="bi-performance.html" class="nav-item">
                    <span class="nav-icon">üéØ</span>
                    <span>Ïã§Ï†Å Î∂ÑÏÑù</span>
                </a>
            </nav>
        </aside>

        <!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
        <main class="main-content">
            <header class="header">
                <h2>Îß§Ï∂ú Î∂ÑÏÑù ÎåÄÏãúÎ≥¥Îìú</h2>
                <div class="header-actions">
                    <label for="yearMonthFilter" style="margin-right: 8px;">Ïó∞Ïõî</label>
                    <input type="text" id="yearMonthFilter" class="form-control" style="width: 150px;" value="2024-01" placeholder="YYYY-MM" pattern="\d{4}-\d{2}">
                    <button class="btn btn-primary" onclick="updateDashboard()">Ï°∞Ìöå</button>
                    <button class="btn btn-outline">PDF ÎÇ¥Î≥¥ÎÇ¥Í∏∞</button>
                    <button class="btn btn-outline">Excel Îã§Ïö¥Î°úÎìú</button>
                </div>
            </header>

            <div class="content">
                <!-- KPI Ïπ¥Îìú Í∑∏Î¶¨Îìú -->
                <div class="bi-grid mb-3">
                    <!-- KPI Ïπ¥ÎìúÎì§ -->
                    <div class="bi-card col-3 kpi-card">
                        <div class="kpi-icon blue">üí∞</div>
                        <div class="kpi-value" id="kpiTotalSales">‚Ç©0</div>
                        <div class="kpi-label">Ï¥ù Îß§Ï∂úÏï°</div>
                        <div class="kpi-change up">‚ñ≤ 12.5% Ï†ÑÎÖÑ ÎåÄÎπÑ</div>
                    </div>
                    <div class="bi-card col-3 kpi-card">
                        <div class="kpi-icon green">üì¶</div>
                        <div class="kpi-value" id="kpiTotalQty">0</div>
                        <div class="kpi-label">Ï¥ù ÌåêÎß§ÏàòÎüâ</div>
                        <div class="kpi-change up">‚ñ≤ 8.3% Ï†ÑÎÖÑ ÎåÄÎπÑ</div>
                    </div>
                    <div class="bi-card col-3 kpi-card">
                        <div class="kpi-icon orange">üßæ</div>
                        <div class="kpi-value" id="kpiAvgOrder">‚Ç©0</div>
                        <div class="kpi-label">ÌèâÍ∑† Ï£ºÎ¨∏Í∏àÏï°</div>
                        <div class="kpi-change down">‚ñº 2.1% Ï†ÑÎÖÑ ÎåÄÎπÑ</div>
                    </div>
                    <div class="bi-card col-3 kpi-card">
                        <div class="kpi-icon purple">üèÜ</div>
                        <div class="kpi-value" id="kpiAchievement">0%</div>
                        <div class="kpi-label">Î™©Ìëú Îã¨ÏÑ±Î•†</div>
                        <div class="kpi-change up">‚ñ≤ 5.2% Ï†ÑÎÖÑ ÎåÄÎπÑ</div>
                    </div>
                </div>

                <div class="bi-grid mb-3">
                    <!-- ÏõîÎ≥Ñ Îß§Ï∂ú Ï∂îÏù¥ -->
                    <div class="bi-card col-8">
                        <div class="bi-header">
                            <h4>ÏõîÎ≥Ñ Îß§Ï∂ú Ï∂îÏù¥</h4>
                            <div class="tab-filter">
                                <button class="active">Îß§Ï∂úÏï°</button>
                                <button>ÌåêÎß§ÏàòÎüâ</button>
                                <button>Ï£ºÎ¨∏Í±¥Ïàò</button>
                            </div>
                        </div>
                        <div class="bi-body">
                            <div class="chart-placeholder">
                                <div class="chart-icon">üìä</div>
                                <div>ÏõîÎ≥Ñ Îß§Ï∂ú Ï∂îÏù¥ Ï∞®Ìä∏ ÏòÅÏó≠</div>
                                <div style="font-size: 0.75rem; margin-top: 8px;">Ïã§Ï†ú Íµ¨ÌòÑ Ïãú Chart.js ÎòêÎäî ApexCharts ÏÇ¨Ïö©</div>
                            </div>
                            <!-- Í∞ÑÎã®Ìïú ÌÖåÏù¥Î∏î ÌòïÌÉú Îç∞Ïù¥ÌÑ∞ ÌëúÏãú -->
                            <table class="bi-table mt-2">
                                <thead>
                                    <tr>
                                        <th>Ïõî</th>
                                        <th class="number">Îß§Ï∂úÏï°</th>
                                        <th class="number">Î™©Ìëú</th>
                                        <th class="number">Îã¨ÏÑ±Î•†</th>
                                        <th>Ï∂îÏù¥</th>
                                    </tr>
                                </thead>
                                <tbody id="monthlyTrendBody">
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ Îß§Ï∂ú -->
                    <div class="bi-card col-4">
                        <div class="bi-header">
                            <h4>Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ Îß§Ï∂ú ÎπÑÏ§ë</h4>
                        </div>
                        <div class="bi-body">
                            <div class="chart-placeholder" style="height: 180px;">
                                <div class="chart-icon">ü•ß</div>
                                <div>ÎèÑÎÑõ Ï∞®Ìä∏ ÏòÅÏó≠</div>
                            </div>
                            <ul class="ranking-list" id="categoryRankingList">
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="bi-grid mb-3">
                    <!-- Í≥†Í∞ùÎ≥Ñ Îß§Ï∂ú TOP 10 -->
                    <div class="bi-card col-6">
                        <div class="bi-header">
                            <h4>Í≥†Í∞ùÎ≥Ñ Îß§Ï∂ú TOP 10</h4>
                            <button class="btn btn-sm btn-outline">ÏÉÅÏÑ∏Î≥¥Í∏∞</button>
                        </div>
                        <div class="bi-body" style="padding: 0;">
                            <table class="bi-table">
                                <thead>
                                    <tr>
                                        <th style="width: 50px;">ÏàúÏúÑ</th>
                                        <th>Í≥†Í∞ùÎ™Ö</th>
                                        <th>Í≥†Í∞ùÏú†Ìòï</th>
                                        <th class="number">Îß§Ï∂úÏï°</th>
                                        <th class="number">ÎπÑÏ§ë</th>
                                    </tr>
                                </thead>
                                <tbody id="customerRankingBody">
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Ï†úÌíàÎ≥Ñ Îß§Ï∂ú TOP 10 -->
                    <div class="bi-card col-6">
                        <div class="bi-header">
                            <h4>Ï†úÌíàÎ≥Ñ Îß§Ï∂ú TOP 10</h4>
                            <button class="btn btn-sm btn-outline">ÏÉÅÏÑ∏Î≥¥Í∏∞</button>
                        </div>
                        <div class="bi-body" style="padding: 0;">
                            <table class="bi-table">
                                <thead>
                                    <tr>
                                        <th style="width: 50px;">ÏàúÏúÑ</th>
                                        <th>Ï†úÌíàÎ™Ö</th>
                                        <th>Ïπ¥ÌÖåÍ≥†Î¶¨</th>
                                        <th class="number">ÌåêÎß§ÏàòÎüâ</th>
                                        <th class="number">Îß§Ï∂úÏï°</th>
                                    </tr>
                                </thead>
                                <tbody id="productRankingBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="bi-grid">
                    <!-- ÏßÄÏó≠Î≥Ñ Îß§Ï∂ú Î∂ÑÌè¨ -->
                    <div class="bi-card col-4">
                        <div class="bi-header">
                            <h4>ÏßÄÏó≠Î≥Ñ Îß§Ï∂ú Î∂ÑÌè¨</h4>
                        </div>
                        <div class="bi-body">
                            <div class="chart-placeholder" style="height: 200px;">
                                <div class="chart-icon">ü•ß</div>
                                <div>ÎèÑÎÑõ Ï∞®Ìä∏ ÏòÅÏó≠</div>
                            </div>
                            <table class="bi-table mt-2">
                                <thead>
                                    <tr>
                                        <th>ÏßÄÏó≠</th>
                                        <th class="number">Îß§Ï∂úÏï°</th>
                                        <th class="number">ÎπÑÏ§ë</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><td>ÏÑúÏö∏/Í≤ΩÍ∏∞</td><td class="number">‚Ç©2,450,000,000</td><td class="number">45.2%</td></tr>
                                    <tr><td>Î∂ÄÏÇ∞/Í≤ΩÎÇ®</td><td class="number">‚Ç©980,000,000</td><td class="number">18.1%</td></tr>
                                    <tr><td>ÎåÄÍµ¨/Í≤ΩÎ∂Å</td><td class="number">‚Ç©720,000,000</td><td class="number">13.3%</td></tr>
                                    <tr><td>ÎåÄÏ†Ñ/Ï∂©Ï≤≠</td><td class="number">‚Ç©650,000,000</td><td class="number">12.0%</td></tr>
                                    <tr><td>Í∏∞ÌÉÄ</td><td class="number">‚Ç©620,000,000</td><td class="number">11.4%</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- ÏãúÍ∞ÑÎåÄÎ≥Ñ Îß§Ï∂ú -->
                    <div class="bi-card col-4">
                        <div class="bi-header">
                            <h4>ÏöîÏùºÎ≥Ñ Îß§Ï∂ú Ìå®ÌÑ¥</h4>
                        </div>
                        <div class="bi-body">
                            <div class="chart-placeholder" style="height: 200px;">
                                <div class="chart-icon">üìä</div>
                                <div>ÎßâÎåÄ Ï∞®Ìä∏ ÏòÅÏó≠</div>
                            </div>
                            <table class="bi-table mt-2">
                                <thead>
                                    <tr>
                                        <th>ÏöîÏùº</th>
                                        <th class="number">Ï£ºÎ¨∏Í±¥Ïàò</th>
                                        <th class="number">Îß§Ï∂úÏï°</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><td>ÏõîÏöîÏùº</td><td class="number">245</td><td class="number">‚Ç©890,000,000</td></tr>
                                    <tr><td>ÌôîÏöîÏùº</td><td class="number">312</td><td class="number">‚Ç©1,120,000,000</td></tr>
                                    <tr><td>ÏàòÏöîÏùº</td><td class="number">298</td><td class="number">‚Ç©1,050,000,000</td></tr>
                                    <tr><td>Î™©ÏöîÏùº</td><td class="number">276</td><td class="number">‚Ç©980,000,000</td></tr>
                                    <tr><td>Í∏àÏöîÏùº</td><td class="number">334</td><td class="number">‚Ç©1,280,000,000</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Îß§Ï∂ú Î™©Ìëú Îã¨ÏÑ± ÌòÑÌô© -->
                    <div class="bi-card col-4">
                        <div class="bi-header">
                            <h4>Î∂ÑÍ∏∞Î≥Ñ Î™©Ìëú Îã¨ÏÑ±</h4>
                        </div>
                        <div class="bi-body">
                            <div class="gauge-container">
                                <div class="gauge-chart">
                                    <div class="gauge-value">87%</div>
                                </div>
                                <div class="gauge-label">Ïó∞Í∞Ñ Î™©Ìëú Îã¨ÏÑ±Î•†</div>
                            </div>

                            <table class="bi-table">
                                <thead>
                                    <tr>
                                        <th>Î∂ÑÍ∏∞</th>
                                        <th class="number">Î™©Ìëú</th>
                                        <th class="number">Ïã§Ï†Å</th>
                                        <th class="number">Îã¨ÏÑ±Î•†</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Q1</td>
                                        <td class="number">‚Ç©1,200M</td>
                                        <td class="number">‚Ç©1,150M</td>
                                        <td class="number positive">95.8%</td>
                                    </tr>
                                    <tr>
                                        <td>Q2</td>
                                        <td class="number">‚Ç©1,400M</td>
                                        <td class="number">‚Ç©1,520M</td>
                                        <td class="number positive">108.6%</td>
                                    </tr>
                                    <tr>
                                        <td>Q3</td>
                                        <td class="number">‚Ç©1,300M</td>
                                        <td class="number">‚Ç©1,180M</td>
                                        <td class="number negative">90.8%</td>
                                    </tr>
                                    <tr>
                                        <td>Q4</td>
                                        <td class="number">‚Ç©1,500M</td>
                                        <td class="number">‚Ç©1,420M</td>
                                        <td class="number positive">94.7%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="../js/mock-data.js"></script>
    <script src="../js/common.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            updateDashboard();
        });

        function updateDashboard() {
            renderKPI();
            renderMonthlyTrend();
            renderCategoryRanking();
            renderCustomerRanking();
            renderProductRanking();
        }

        function renderKPI() {
            const totalSales = SALES_PERFORMANCE.reduce((sum, p) => sum + p.SALE_AMT, 0);
            const totalQty = SALES_PERFORMANCE.reduce((sum, p) => sum + p.SALE_QTY, 0);
            const avgOrder = SALES_PERFORMANCE.length > 0 ? totalSales / SALES_PERFORMANCE.length : 0;
            const totalTarget = SALES_PLANS.reduce((sum, p) => sum + p.PLAN_AMT, 0);
            const achievement = totalTarget > 0 ? (totalSales / totalTarget * 100) : 0;

            document.getElementById('kpiTotalSales').textContent = formatCurrency(totalSales);
            document.getElementById('kpiTotalQty').textContent = formatNumber(totalQty) + 'Í∞ú';
            document.getElementById('kpiAvgOrder').textContent = formatCurrency(Math.round(avgOrder));
            document.getElementById('kpiAchievement').textContent = formatPercent(achievement);
        }

        function renderMonthlyTrend() {
            const tbody = document.getElementById('monthlyTrendBody');
            tbody.innerHTML = '';

            MONTHLY_SALES.forEach((item, idx) => {
                const rate = item.target > 0 ? (item.sales / item.target * 100) : 0;
                const rateClass = rate >= 100 ? 'positive' : (rate >= 90 ? '' : 'negative');
                const prevSales = idx > 0 ? MONTHLY_SALES[idx - 1].sales : item.sales;
                const trend = item.sales >= prevSales ? 'üìà' : 'üìâ';

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${item.month}</td>
                    <td class="number">${formatCurrency(item.sales)}</td>
                    <td class="number">${formatCurrency(item.target)}</td>
                    <td class="number ${rateClass}">${formatPercent(rate)}</td>
                    <td style="text-align: center;">${trend}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function renderCategoryRanking() {
            const list = document.getElementById('categoryRankingList');
            list.innerHTML = '';

            const total = CATEGORY_SALES.reduce((sum, c) => sum + c.sales, 0);

            CATEGORY_SALES.slice(0, 5).forEach((item, idx) => {
                const ratio = total > 0 ? (item.sales / total * 100) : 0;
                const rankClass = idx === 0 ? 'top-1' : (idx === 1 ? 'top-2' : (idx === 2 ? 'top-3' : ''));

                const li = document.createElement('li');
                li.innerHTML = `
                    <span class="rank ${rankClass}">${idx + 1}</span>
                    <div class="info">
                        <div class="name">${item.category}</div>
                        <div class="sub">${formatCurrency(item.sales)}</div>
                    </div>
                    <div class="value">${formatPercent(ratio)}</div>
                `;
                list.appendChild(li);
            });
        }

        function renderCustomerRanking() {
            const tbody = document.getElementById('customerRankingBody');
            tbody.innerHTML = '';

            // Í≥†Í∞ùÎ≥Ñ Îß§Ï∂ú ÏßëÍ≥Ñ
            const customerSales = {};
            SALES_PERFORMANCE.forEach(p => {
                if (!customerSales[p.CUST_ID]) {
                    customerSales[p.CUST_ID] = 0;
                }
                customerSales[p.CUST_ID] += p.SALE_AMT;
            });

            const total = Object.values(customerSales).reduce((sum, v) => sum + v, 0);
            const sortedCustomers = Object.entries(customerSales)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);

            sortedCustomers.forEach(([custId, sales], idx) => {
                const cust = CUSTOMERS.find(c => c.CUST_ID === custId);
                const ratio = total > 0 ? (sales / total * 100) : 0;

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><strong>${idx + 1}</strong></td>
                    <td>${cust ? cust.CUST_NM : custId}</td>
                    <td>${cust ? getCodeName('CUST_TYPE', cust.CUST_TYPE) : '-'}</td>
                    <td class="number"><strong>${formatCurrency(sales)}</strong></td>
                    <td class="number">${formatPercent(ratio)}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function renderProductRanking() {
            const tbody = document.getElementById('productRankingBody');
            tbody.innerHTML = '';

            // Ï†úÌíàÎ≥Ñ Îß§Ï∂ú ÏßëÍ≥Ñ
            const productSales = {};
            const productQty = {};
            SALES_PERFORMANCE.forEach(p => {
                if (!productSales[p.PROD_ID]) {
                    productSales[p.PROD_ID] = 0;
                    productQty[p.PROD_ID] = 0;
                }
                productSales[p.PROD_ID] += p.SALE_AMT;
                productQty[p.PROD_ID] += p.SALE_QTY;
            });

            const sortedProducts = Object.entries(productSales)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);

            sortedProducts.forEach(([prodId, sales], idx) => {
                const prod = PRODUCTS.find(p => p.PROD_ID === prodId);
                const qty = productQty[prodId] || 0;

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><strong>${idx + 1}</strong></td>
                    <td>${prod ? prod.PROD_NM : prodId}</td>
                    <td>${prod ? getCodeName('PROD_CATEGORY', prod.CATEGORY) : '-'}</td>
                    <td class="number">${formatNumber(qty)}</td>
                    <td class="number"><strong>${formatCurrency(sales)}</strong></td>
                `;
                tbody.appendChild(tr);
            });
        }
    </script>
</body>
</html>
